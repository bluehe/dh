<?php

use yii\db\Migration;

/**
 * Handles the creation of table `bed`.
 */
class m170413_152706_create_bed_table extends Migration {

    /**
     * @inheritdoc
     */
    public function up() {
        $table = '{{%bed}}';
        $roomTable = '{{%room}}';
        $tableOptions = null;
        if ($this->db->driverName === 'mysql') {
            // http://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
            $tableOptions = 'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB COMMENT="床位表"';
        }
        $this->createTable($table, [
            'id' => $this->primaryKey(),
            'rid' => $this->integer()->notNull(),
            'name' => $this->string(32)->notNull(),
            'note' => $this->string(64),
            'stat' => $this->smallInteger()->notNull()->defaultValue(1),
            "FOREIGN KEY ([[rid]]) REFERENCES {$roomTable}([[id]]) ON DELETE CASCADE ON UPDATE CASCADE",
                ], $tableOptions);
        //测试数据
        $this->batchInsert($table, ['id', 'rid', 'name', 'note', 'stat'], [
            ['1', '10', '1', '', '1'],
            ['2', '10', '2', '', '1'],
            ['3', '10', '3', '', '1'],
            ['4', '10', '4', '', '1'],
            ['5', '11', '1', '', '1'],
            ['6', '11', '2', '', '1'],
            ['7', '11', '3', '', '1'],
            ['8', '11', '4', '', '1'],
            ['9', '12', '1', '', '1'],
            ['10', '12', '2', '', '1'],
            ['11', '12', '3', '', '1'],
            ['12', '12', '4', '', '1'],
            ['13', '13', '1', '', '1'],
            ['14', '13', '2', '', '1'],
            ['15', '13', '3', '', '1'],
            ['16', '13', '4', '', '1'],
            ['17', '14', '1', '', '1'],
            ['18', '14', '2', '', '1'],
            ['19', '14', '3', '', '1'],
            ['20', '14', '4', '', '1'],
            ['21', '15', '1', '', '1'],
            ['22', '15', '2', '', '1'],
            ['23', '15', '3', '', '1'],
            ['24', '15', '4', '', '1'],
            ['25', '16', '1', '', '1'],
            ['26', '16', '2', '', '1'],
            ['27', '16', '3', '', '1'],
            ['28', '16', '4', '', '1'],
            ['29', '17', '1', '', '1'],
            ['30', '17', '2', '', '1'],
            ['31', '17', '3', '', '1'],
            ['32', '17', '4', '', '1'],
            ['33', '18', '1', '', '1'],
            ['34', '18', '2', '', '1'],
            ['35', '18', '3', '', '1'],
            ['36', '18', '4', '', '1'],
            ['37', '19', '1', '', '1'],
            ['38', '19', '2', '', '1'],
            ['39', '19', '3', '', '1'],
            ['40', '19', '4', '', '1'],
            ['41', '20', '1', '', '1'],
            ['42', '20', '2', '', '1'],
            ['43', '20', '3', '', '1'],
            ['44', '20', '4', '', '1'],
            ['45', '21', '1', '', '1'],
            ['46', '21', '2', '', '1'],
            ['47', '21', '3', '', '1'],
            ['48', '21', '4', '', '1'],
            ['49', '22', '1', '', '1'],
            ['50', '22', '2', '', '1'],
            ['51', '22', '3', '', '1'],
            ['52', '22', '4', '', '1'],
            ['53', '23', '1', '', '1'],
            ['54', '23', '2', '', '1'],
            ['55', '23', '3', '', '1'],
            ['56', '23', '4', '', '1'],
            ['57', '24', '1', '', '1'],
            ['58', '24', '2', '', '1'],
            ['59', '24', '3', '', '1'],
            ['60', '24', '4', '', '1'],
            ['61', '25', '1', '', '1'],
            ['62', '25', '2', '', '1'],
            ['63', '25', '3', '', '1'],
            ['64', '25', '4', '', '1'],
            ['65', '26', '1', '', '1'],
            ['66', '26', '2', '', '1'],
            ['67', '26', '3', '', '1'],
            ['68', '26', '4', '', '1'],
            ['69', '27', '1', '', '1'],
            ['70', '27', '2', '', '1'],
            ['71', '27', '3', '', '1'],
            ['72', '27', '4', '', '1'],
        ]);
    }

    /**
     * @inheritdoc
     */
    public function down() {
        $this->dropTable('{{%bed}}');
    }

}
